# ServiceNow GitHub Application Vulnerability Integration

**Plugin**: GitHub Application Vulnerability Integration (sn_vul_github)
**Version**: 2.3.0
**Category**: Vulnerability Response
**Status**: ✅ Installed

---

## Overview

The **GitHub Application Vulnerability Integration** (sn_vul_github) is designed to sync **GitHub Dependabot alerts and Security Advisories** into ServiceNow's Vulnerability Response module.

### What This Plugin Does

✅ **GitHub Dependabot Alerts** → ServiceNow Vulnerability Records
✅ **GitHub Security Advisories** → ServiceNow Vulnerability Records
✅ **CVE Integration** → Links GitHub alerts to CVE database
✅ **Automatic Vulnerability Tracking** → Creates vulnerability items in ServiceNow

### What This Plugin Does NOT Do

❌ **Does NOT store custom security scan results** (CodeQL, Semgrep, Trivy, etc.)
❌ **Does NOT integrate with GitHub Actions security workflows**
❌ **Does NOT provide the `/api/sn_devops/devops/security/result` API endpoint**
❌ **Does NOT support the `servicenow-devops-security-result` GitHub Action**

---

## The Confusion

### What We Were Trying to Do

We attempted to use the `ServiceNow/servicenow-devops-security-result@v3.1.0` GitHub Action to register 10 security scanners:

1. CodeQL (Python, JavaScript, Go, Java, C#)
2. Semgrep SAST
3. Trivy filesystem scan
4. Checkov IaC scan
5. tfsec Terraform scan
6. Polaris Kubernetes scan

**Expected Result**: Security scan results stored in ServiceNow DevOps tables
**Actual Result**: GitHub Action reports SUCCESS but no data appears in ServiceNow
**Root Cause**: The required API endpoint doesn't exist

### Why the GitHub Action Fails

The `servicenow-devops-security-result` action calls:
```
POST /api/sn_devops/devops/security/result
```

But this endpoint **does not exist** in our ServiceNow instance:
```bash
$ curl "https://calitiiltddemo3.service-now.com/api/sn_devops/devops/security/result?toolId=..."

{
  "error": {
    "message": "Requested URI does not represent any resource",
    "detail": null
  }
}
```

### What Plugin Is Actually Needed

The `servicenow-devops-security-result` action requires a **different plugin**:

**Required Plugin**: ServiceNow DevOps Security Plugin (NOT GitHub Vulnerability Integration)
**API Endpoint**: `/api/sn_devops/devops/security/result`
**Tables**: `sn_devops_test_result`, `sn_devops_test_execution`, `sn_devops_security_result`

**What We Have**: GitHub Application Vulnerability Integration (sn_vul_github)
**API Endpoint**: `/api/sn_vul/...` (different API namespace)
**Tables**: `sn_vul_vulnerable_item`, `sn_vul_entry`, etc.

---

## Plugin Comparison

| Feature | GitHub Vulnerability Integration<br>(sn_vul_github) | ServiceNow DevOps Security<br>(MISSING) |
|---------|---------------------------------------------|----------------------------------------|
| **Purpose** | Sync GitHub Dependabot alerts | Store custom security scan results |
| **Data Source** | GitHub Security Advisories | GitHub Actions workflows |
| **Integration** | Automatic sync via GitHub App | Manual API calls from workflows |
| **API Namespace** | `/api/sn_vul/*` | `/api/sn_devops/*` |
| **Tables** | `sn_vul_vulnerable_item`<br>`sn_vul_entry`<br>`sn_vul_m2m_entry_cve` | `sn_devops_test_result`<br>`sn_devops_test_execution`<br>`sn_devops_security_result` |
| **GitHub Action** | N/A (automatic) | `servicenow-devops-security-result` |
| **Use Case** | Track known CVEs in dependencies | Track security scan results in CI/CD |

---

## Tables Provided by sn_vul_github

The installed plugin created these tables:

```
sn_vul_vulnerable_item         - Vulnerability items
sn_vul_entry                   - Vulnerability entries
sn_vul_m2m_entry_cve           - Vulnerability CVEs
sn_vul_m2m_exp_sw_vi           - Assessed Vulnerable Items
sn_vul_m2m_ttr_status          - Vulnerability Remediation Status
sn_vul_exploit                 - Exploit information
sn_vul_reference               - Vulnerability References
sn_vul_vendor                  - Software Vendors
```

These are for **Dependabot/Security Advisory integration**, not for custom security scan results from GitHub Actions.

---

## How to Use sn_vul_github (If Desired)

### Configuration Steps

1. **Install GitHub App in ServiceNow**:
   - Navigate to: GitHub Application Vulnerability Integration
   - Configure GitHub App credentials
   - Select repositories to monitor

2. **Enable Dependabot Alerts in GitHub**:
   ```
   Settings → Security & analysis → Dependabot alerts (Enable)
   ```

3. **Configure Sync Schedule**:
   - ServiceNow will automatically pull Dependabot alerts
   - Default: Daily sync
   - Configurable in plugin settings

4. **View Vulnerabilities**:
   - Navigate to: Vulnerability Response → Vulnerable Items
   - Filter by source: GitHub

### What Data Syncs

- **Dependency vulnerabilities** detected by Dependabot
- **CVE information** from GitHub Security Advisories
- **Severity ratings** (Critical, High, Medium, Low)
- **Remediation recommendations** from GitHub
- **Affected dependencies** and versions

---

## Solution for Our Use Case

Since the `servicenow-devops-security-result` GitHub Action doesn't work, we have 3 options:

### Option A: Manual SARIF Upload to Change Requests ✅ RECOMMENDED

Upload security scan SARIF files as **attachments** to change requests:

```yaml
- name: Upload Security Evidence to ServiceNow
  run: |
    CHANGE_SYS_ID="${{ needs.create-change-request.outputs.change_request_sys_id }}"

    # Upload SARIF files
    for sarif_file in security-scan-evidence/*.sarif; do
      echo "Uploading $(basename $sarif_file)..."
      curl -s -u "${{ secrets.SERVICENOW_USERNAME }}:${{ secrets.SERVICENOW_PASSWORD }}" \
        -F "file=@$sarif_file" \
        -F "table_name=change_request" \
        -F "table_sys_id=$CHANGE_SYS_ID" \
        "${{ secrets.SERVICENOW_INSTANCE_URL }}/api/now/attachment/upload"
    done
```

**Benefits**:
- ✅ Works with existing ServiceNow setup (no special plugin needed)
- ✅ SARIF files are industry standard format
- ✅ Evidence attached directly to change requests
- ✅ Visible to approvers during change review

**Limitations**:
- ⚠️ No structured data in ServiceNow tables
- ⚠️ Can't query/report on vulnerability counts
- ⚠️ Manual review required to extract findings

### Option B: Work Notes with Security Summary

Add security scan summary as **work notes** on change requests:

```yaml
- name: Add Security Scan Summary to Change Request
  run: |
    CHANGE_SYS_ID="${{ needs.create-change-request.outputs.change_request_sys_id }}"

    # Count findings from SARIF files
    TOTAL_FINDINGS=$(jq -s '[.[] | .runs[].results[]] | length' security-scan-evidence/*.sarif)
    CRITICAL=$(jq -s '[.[] | .runs[].results[] | select(.level=="error")] | length' security-scan-evidence/*.sarif)
    HIGH=$(jq -s '[.[] | .runs[].results[] | select(.level=="warning")] | length' security-scan-evidence/*.sarif)

    # Create work note
    WORK_NOTE="Security Scan Results (Build ${{ github.run_id }}):

    Total Findings: $TOTAL_FINDINGS
    - Critical: $CRITICAL
    - High: $HIGH

    Scanners Executed:
    - CodeQL (5 languages)
    - Semgrep SAST
    - Trivy filesystem
    - Checkov IaC
    - tfsec Terraform
    - Polaris Kubernetes

    All SARIF files attached to this change request."

    # Add to change request
    curl -X PATCH \
      -u "${{ secrets.SERVICENOW_USERNAME }}:${{ secrets.SERVICENOW_PASSWORD }}" \
      -H "Content-Type: application/json" \
      -d "$(jq -n --arg note "$WORK_NOTE" '{work_notes: $note}')" \
      "${{ secrets.SERVICENOW_INSTANCE_URL }}/api/now/table/change_request/$CHANGE_SYS_ID"
```

**Benefits**:
- ✅ Summary visible to approvers immediately
- ✅ Includes vulnerability counts
- ✅ Lists all scanners executed
- ✅ Works with existing setup

### Option C: Custom Integration Table

Create a **custom table** in ServiceNow to store security scan results:

```sql
-- Custom Table: u_security_scan_result
Fields:
- u_change_request (Reference to change_request)
- u_scanner_name (String)
- u_scan_id (String)
- u_total_findings (Integer)
- u_critical_count (Integer)
- u_high_count (Integer)
- u_medium_count (Integer)
- u_low_count (Integer)
- u_scan_status (Choice: passed, failed, warning)
- u_sarif_file (Attachment)
```

**Benefits**:
- ✅ Structured data for reporting
- ✅ Can query/aggregate across scans
- ✅ Dashboard/metrics possible
- ✅ Full control over data model

**Drawbacks**:
- ⚠️ Requires ServiceNow admin to create table
- ⚠️ Custom code to populate
- ⚠️ Not standard ServiceNow module

---

## Recommended Action Plan

1. **Remove `servicenow-devops-security-result` action** from workflow (it doesn't work)
2. **Implement Option A + Option B** (SARIF upload + work notes summary)
3. **Test with new deployment** to verify attachments and work notes appear
4. **Consider Option C** if reporting/metrics are needed long-term

---

## Testing Checklist

After implementing the fix:

- [ ] Trigger deployment workflow
- [ ] Verify change request created successfully
- [ ] Check change request has SARIF file attachments (10 files expected)
- [ ] Verify work notes include security scan summary
- [ ] Confirm security findings count is accurate
- [ ] Test that approvers can view SARIF files

---

## Related Documentation

- [SERVICENOW-SECURITY-TOOLS-VERIFICATION.md](SERVICENOW-SECURITY-TOOLS-VERIFICATION.md) - Original investigation
- [GITHUB-SERVICENOW-ONBOARDING.md](GITHUB-SERVICENOW-ONBOARDING.md) - Integration setup guide
- [GITHUB-SERVICENOW-ANTIPATTERNS.md](GITHUB-SERVICENOW-ANTIPATTERNS.md) - Common mistakes

---

**Last Updated**: 2025-10-22
**Status**: Plugin installed but not suitable for our use case. Implementing alternative approach (SARIF upload + work notes).
